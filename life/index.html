<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life in Weeks - Neo-Morphic Dark</title>
    <style>
        :root {
            /* Neo-Morphic Dark Theme Colors */
            --background-color: #1a1a1a; /* Deep Black */
            --surface-color: #2b2b2b;   /* Slightly lighter Grey for main elements */
            --text-color: #e0e0e0;      /* Light Grey for primary text */
            --secondary-text-color: #a0a0a0; /* Even lighter Grey for secondary text */
            --accent-color: #ff8c00;    /* Vibrant Orange */
            --accent-light-color: #ffaa33; /* Lighter Orange for highlights */
            --border-color: #3a3a3a;    /* Darker grey for borders/dividers */

            /* Neo-Morphic Shadows */
            --shadow-dark: rgba(0, 0, 0, 0.5);   /* Darker shadow for depth */
            --shadow-light: rgba(60, 60, 60, 0.4); /* Lighter shadow for highlights */
            
            /* Specific element highlights/recess */
            --recess-bg: #222222; /* Background for recessed elements like future weeks */
            --recess-border: #333333; /* Border for recessed elements */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';
            background: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 2.5rem 1.5rem;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 3.5rem;
        }

        .title {
            font-size: 2.75rem;
            font-weight: 700;
            color: var(--text-color); /* Main text color */
            margin-bottom: 0.75rem;
            letter-spacing: -0.03em;
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--secondary-text-color);
            font-weight: 400;
        }
        
        /* --- Controls --- */
        .controls {
            display: flex;
            justify-content: center;
            gap: 2.5rem;
            margin-bottom: 3.5rem;
            flex-wrap: wrap;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .input-group label {
            font-size: 0.95rem;
            color: var(--secondary-text-color);
            font-weight: 500;
        }

        .input-group input, .input-group select {
            padding: 0.8rem 1.2rem;
            border: none; /* No visible border for neo-morphism */
            border-radius: 12px;
            background: var(--surface-color);
            font-size: 1rem;
            min-width: 150px;
            color: var(--text-color);
            transition: all 0.2s ease;
            appearance: none;
            /* Neo-morphic recessed look */
            box-shadow: inset 5px 5px 10px var(--shadow-dark), 
                        inset -5px -5px 10px var(--shadow-light);
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            /* Slightly more defined inset on focus */
            box-shadow: inset 2px 2px 5px var(--shadow-dark), 
                        inset -2px -2px 5px var(--shadow-light),
                        0 0 0 3px var(--accent-light-color); /* Accent border on focus */
        }

        /* --- View Modes and Buttons --- */
        .view-modes {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2.5rem;
            flex-wrap: wrap;
        }

        .view-mode {
            padding: 0.75rem 1.5rem;
            border: none;
            background: var(--surface-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--secondary-text-color);
            /* Neo-morphic raised look */
            box-shadow: 5px 5px 10px var(--shadow-dark), 
                        -5px -5px 10px var(--shadow-light);
        }

        .view-mode:hover {
            color: var(--accent-light-color);
            box-shadow: 3px 3px 7px var(--shadow-dark), 
                        -3px -3px 7px var(--shadow-light);
            transform: translateY(-1px);
        }

        .view-mode.active {
            background: var(--accent-color); /* Orange for active state */
            color: var(--background-color); /* Dark text on orange */
            box-shadow: inset 3px 3px 7px rgba(0,0,0,0.3), /* Inset for pressed look */
                        inset -3px -3px 7px rgba(255,170,51,0.3); /* Lighter inset shadow */
            transform: none; /* No lift on active */
        }

        /* --- Stats Grid --- */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--surface-color);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            /* Neo-morphic raised card */
            box-shadow: 8px 8px 16px var(--shadow-dark), 
                        -8px -8px 16px var(--shadow-light);
        }

        .stat-number {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--accent-color); /* Orange for numbers */
            display: block;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-color);
        }

        .stat-detail {
            font-size: 0.9rem;
            color: var(--secondary-text-color);
            margin-top: 0.5rem;
        }

        /* --- Main Grid Visualization --- */
        .grid-container {
            background: var(--surface-color);
            border-radius: 16px;
            padding: 2.5rem;
            margin-bottom: 2.5rem;
            /* Neo-morphic raised panel */
            box-shadow: 8px 8px 16px var(--shadow-dark), 
                        -8px -8px 16px var(--shadow-light);
        }

        .year-labels {
            display: flex;
            margin-bottom: 1rem;
            padding-left: 3rem;
        }

        .year-label {
            flex: 1;
            text-align: center;
            font-size: 0.9rem;
            color: var(--secondary-text-color);
            font-weight: 500;
        }

        .grid-row {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }

        .age-label {
            width: 3rem;
            text-align: right;
            font-size: 0.9rem;
            color: var(--secondary-text-color);
            margin-right: 1.5rem;
            font-weight: 500;
        }

        .weeks-row {
            display: flex;
            gap: 2px;
            flex-wrap: nowrap;
        }

        .week {
            width: 9px;
            height: 9px;
            border-radius: 2px;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }

        /* Neo-morphic week cells */
        .week.lived {
            background: var(--accent-color); /* Orange for lived */
            box-shadow: 2px 2px 4px rgba(0,0,0,0.3), 
                        -2px -2px 4px rgba(255,170,51,0.3); /* Subtle raised orange */
        }

        .week.current {
            background: var(--accent-light-color); /* Brighter orange for current */
            box-shadow: 0 0 10px var(--accent-light-color), /* Glow effect */
                        3px 3px 6px rgba(0,0,0,0.5), 
                        -3px -3px 6px rgba(255,170,51,0.5);
            transform: scale(1.3);
            border: none;
        }

        .week.future {
            background: var(--recess-bg); /* Darker grey for recessed future weeks */
            border: 1px solid var(--recess-border);
            box-shadow: inset 1px 1px 2px var(--shadow-dark), 
                        inset -1px -1px 2px var(--shadow-light); /* Subtle inset */
        }

        .week:hover {
            transform: scale(1.6);
            z-index: 10;
            box-shadow: 0 0 15px var(--accent-light-color); /* Glow on hover */
        }

        /* Data overlays for seasons (still distinct colors) */
        .week.season-spring { border-top: 2px solid #52b788; } /* Green */
        .week.season-summer { border-top: 2px solid #ffb703; } /* Yellow-Orange */
        .week.season-autumn { border-top: 2px solid #e76f51; } /* Red-Orange */
        .week.season-winter { border-top: 2px solid #4a90e2; } /* Blue */

        /* General milestone (existing) */
        .week.milestone::after {
            content: '';
            position: absolute;
            top: -2px;
            right: -2px;
            width: 5px;
            height: 5px;
            background: var(--text-color); /* Light grey dot for general milestones */
            border: 1px solid var(--background-color);
            border-radius: 50%;
        }

        /* Personal milestone (new) */
        .week.personal-milestone {
            border: 2px solid var(--accent-light-color); /* Orange border */
            box-shadow: 0 0 8px var(--accent-light-color); /* Orange glow */
            transform: scale(1.2);
            position: relative;
            z-index: 5;
        }
        .week.personal-milestone::after {
            content: '';
            position: absolute;
            top: -2px;
            right: -2px;
            width: 5px;
            height: 5px;
            background: var(--accent-light-color); /* Orange dot */
            border: 1px solid var(--background-color);
            border-radius: 50%;
        }


        /* --- Legend --- */
        .legend {
            display: flex;
            justify-content: center;
            gap: 2.5rem;
            margin-top: 2.5rem;
            font-size: 0.95rem;
            flex-wrap: wrap;
            color: var(--secondary-text-color); /* Legend text */
        }

        .legend-section {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            align-items: flex-start;
        }

        .legend-title {
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 0.5rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .legend-color.lived { background: var(--accent-color); }
        .legend-color.current { background: var(--accent-light-color); box-shadow: 0 0 8px var(--accent-light-color); }
        .legend-color.future { background: var(--recess-bg); border: 1px solid var(--recess-border); }
        .legend-color.spring { background: #52b788; }
        .legend-color.summer { background: #ffb703; }
        .legend-color.autumn { background: #e76f51; }
        .legend-color.winter { background: #4a90e2; }
        .legend-color.milestone { background: var(--text-color); border-radius: 50%; width: 12px; height: 12px; }
        .legend-color.personal-milestone { background: var(--accent-light-color); border: 2px solid var(--accent-light-color); }

        /* --- Insights --- */
        .insights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .insight-card {
            background: var(--surface-color);
            border-radius: 16px;
            padding: 2rem;
            /* Neo-morphic raised card */
            box-shadow: 8px 8px 16px var(--shadow-dark), 
                        -8px -8px 16px var(--shadow-light);
        }

        .insight-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--accent-color); /* Orange for insight titles */
            margin-bottom: 1.25rem;
        }

        .insight-list {
            list-style: none;
            padding-left: 0;
            line-height: 1.8;
        }

        .insight-list li {
            margin-bottom: 0.5rem;
            color: var(--text-color);
            font-size: 0.95rem;
        }

        /* --- Tooltip --- */
        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9); /* Darker background for tooltip */
            color: white;
            padding: 1rem 1.25rem;
            border-radius: 10px;
            font-size: 0.9rem;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s ease;
            max-width: 300px;
            line-height: 1.4;
            box-shadow: 0 6px 15px var(--shadow-dark); /* Dark shadow for tooltip */
            border: 1px solid var(--border-color); /* Subtle border */
        }

        .tooltip strong {
            color: var(--accent-light-color); /* Orange for strong text in tooltip */
            display: block;
            margin-bottom: 0.25rem;
        }

        /* --- Modal for adding milestones --- */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Darker modal overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.3s;
        }

        .modal.show {
            visibility: visible;
            opacity: 1;
        }

        .modal-content {
            background: var(--surface-color);
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            /* Neo-morphic raised modal */
            box-shadow: 8px 8px 25px var(--shadow-dark), 
                        -8px -8px 25px var(--shadow-light);
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.5rem;
            color: var(--accent-color); /* Orange for modal title */
        }

        .modal-close {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary-text-color);
            cursor: pointer;
        }
        .modal-close:hover {
            color: var(--accent-light-color);
        }

        .modal-body label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-color);
        }

        .modal-body input, .modal-body textarea {
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            color: var(--text-color);
            background: var(--recess-bg); /* Darker background for modal inputs */
            /* Neo-morphic recessed inputs */
            box-shadow: inset 3px 3px 6px var(--shadow-dark), 
                        inset -3px -3px 6px var(--shadow-light);
        }
        .modal-body input:focus, .modal-body textarea:focus {
            outline: none;
            box-shadow: inset 1px 1px 3px var(--shadow-dark), 
                        inset -1px -1px 3px var(--shadow-light),
                        0 0 0 2px var(--accent-light-color); /* Accent border on focus */
        }

        .modal-body textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            /* Neo-morphic raised button */
            box-shadow: 3px 3px 6px var(--shadow-dark), 
                        -3px -3px 6px var(--shadow-light);
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 2px 2px 4px var(--shadow-dark), 
                        -2px -2px 4px var(--shadow-light);
        }
        .btn:active {
            box-shadow: inset 2px 2px 4px var(--shadow-dark), 
                        inset -2px -2px 4px var(--shadow-light);
            transform: translateY(0);
        }


        .btn-primary {
            background-color: var(--accent-color);
            color: var(--background-color); /* Dark text on orange button */
        }

        .btn-primary:hover {
            background-color: var(--accent-light-color);
        }

        .btn-secondary {
            background-color: var(--border-color); /* A darker grey for secondary */
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background-color: #4a4a4a; /* Slightly lighter hover for secondary */
        }

        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
            body {
                padding: 1.5rem 0.5rem;
            }
            .title { font-size: 2.2rem; }
            .subtitle { font-size: 1rem; }
            .controls { gap: 1.5rem; }
            .stats-grid, .insights {
                grid-template-columns: 1fr;
            }
            .grid-container { 
                padding: 1rem; 
                overflow-x: auto;
            }
            .year-labels, .grid-row { 
                min-width: 650px; 
            }
            .legend {
                flex-direction: column;
                align-items: center;
                gap: 1.5rem;
            }
            .legend-section {
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">Life in Weeks</h1>
            <p class="subtitle">A visual perspective on the journey of your life</p>
        </div>

        <div class="controls">
            <div class="input-group">
                <label for="birthDate">Birth Date</label>
                <input type="date" id="birthDate" value="1990-01-01">
            </div>
            <div class="input-group">
                <label for="lifeExpectancy">Life Expectancy</label>
                <input type="number" id="lifeExpectancy" value="80" min="50" max="120">
            </div>
            <div class="input-group">
                <label for="birthLocation">Birth Location</label>
                <select id="birthLocation">
                    <option value="global">Global</option>
                    <option value="north">Northern Hemisphere</option>
                    <option value="south">Southern Hemisphere</option>
                </select>
            </div>
        </div>

        <div class="view-modes">
            <div class="view-mode active" data-mode="basic">Basic View</div>
            <div class="view-mode" data-mode="seasons">Seasons</div>
            <div class="view-mode" data-mode="population">World Population</div>
            <div class="view-mode" data-mode="milestones">Life Milestones</div>
        </div>

        <div class="stats-grid" id="statsGrid">
            </div>

        <div class="grid-container">
            <div class="year-labels" id="yearLabels"></div>
            <div class="grid" id="grid"></div>
        </div>

        <div class="legend" id="legend">
            </div>

        <div class="insights" id="insights">
            </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <div id="milestoneModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Milestone</h3>
                <span class="modal-close">&times;</span>
            </div>
            <div class="modal-body">
                <label for="milestoneTitle">Title</label>
                <input type="text" id="milestoneTitle" placeholder="e.g., First Job, Bought a house">
                <label for="milestoneNote">Notes</label>
                <textarea id="milestoneNote" placeholder="A brief description of this milestone..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelMilestone">Cancel</button>
                <button class="btn btn-primary" id="saveMilestone">Save Milestone</button>
            </div>
        </div>
    </div>

    <script>
        class EnhancedLifeInWeeks {
            constructor() {
                this.birthDate = new Date('1990-01-01');
                this.lifeExpectancy = 80;
                this.birthLocation = 'global';
                this.today = new Date();
                this.currentMode = 'basic';
                this.personalMilestones = {};
                this.selectedWeek = null;
                
                this.worldData = {
                    populationGrowth: {
                        1990: 5.3, 2000: 6.1, 2010: 6.9, 2020: 7.8, 2030: 8.5, 2040: 9.2, 2050: 9.7
                    },
                    climateData: {
                        avgTempIncrease: 0.18,
                        co2Levels: { 1990: 354, 2020: 414, 2050: 480 }
                    },
                    techMilestones: {
                        1991: "World Wide Web launched",
                        1995: "Amazon founded", 
                        1998: "Google founded",
                        2004: "Facebook launched",
                        2007: "iPhone released",
                        2010: "Instagram launched",
                        2016: "AlphaGo beats world champion",
                        2020: "COVID-19 pandemic",
                        2022: "ChatGPT launched"
                    },
                    lifeMilestones: {
                        0: "Birth", 1: "First words", 5: "School starts", 16: "Driving age",
                        18: "Legal adult", 22: "College graduation", 25: "Brain fully developed",
                        30: "Career peak begins", 40: "Midlife", 50: "Empty nest", 
                        65: "Retirement age", 70: "Wisdom years"
                    }
                };
                
                this.loadData();
                this.initEventListeners();
                this.updateVisualization();
            }

            // --- Local Storage Management ---
            saveData() {
                localStorage.setItem('birthDate', this.birthDate.toISOString().split('T')[0]);
                localStorage.setItem('lifeExpectancy', this.lifeExpectancy);
                localStorage.setItem('personalMilestones', JSON.stringify(this.personalMilestones));
            }

            loadData() {
                const storedBirthDate = localStorage.getItem('birthDate');
                const storedLifeExpectancy = localStorage.getItem('lifeExpectancy');
                const storedMilestones = localStorage.getItem('personalMilestones');
                
                if (storedBirthDate) document.getElementById('birthDate').value = storedBirthDate;
                if (storedLifeExpectancy) document.getElementById('lifeExpectancy').value = storedLifeExpectancy;
                if (storedMilestones) this.personalMilestones = JSON.parse(storedMilestones);

                this.birthDate = new Date(document.getElementById('birthDate').value);
                this.lifeExpectancy = parseInt(document.getElementById('lifeExpectancy').value);
            }

            // --- Event Listeners ---
            initEventListeners() {
                const birthDateInput = document.getElementById('birthDate');
                const lifeExpectancyInput = document.getElementById('lifeExpectancy');
                const birthLocationInput = document.getElementById('birthLocation');
                const milestoneModal = document.getElementById('milestoneModal');
                
                birthDateInput.addEventListener('change', (e) => {
                    this.birthDate = new Date(e.target.value);
                    this.saveData();
                    this.updateVisualization();
                });

                lifeExpectancyInput.addEventListener('input', (e) => {
                    this.lifeExpectancy = parseInt(e.target.value);
                    this.saveData();
                    this.updateVisualization();
                });

                birthLocationInput.addEventListener('change', (e) => {
                    this.birthLocation = e.target.value;
                    this.updateVisualization();
                });

                const viewModes = document.querySelectorAll('.view-mode');
                viewModes.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        viewModes.forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentMode = e.target.dataset.mode;
                        this.updateVisualization();
                    });
                });

                document.querySelector('.modal-close').addEventListener('click', () => this.hideModal());
                document.getElementById('cancelMilestone').addEventListener('click', () => this.hideModal());
                document.getElementById('saveMilestone').addEventListener('click', () => this.saveMilestone());
            }

            // --- Milestone Modal Functions ---
            showModal(weekNumber) {
                this.selectedWeek = weekNumber;
                const modal = document.getElementById('milestoneModal');
                const titleInput = document.getElementById('milestoneTitle');
                const noteTextarea = document.getElementById('milestoneNote');

                const existing = this.personalMilestones[weekNumber];
                if (existing) {
                    titleInput.value = existing.title;
                    noteTextarea.value = existing.note;
                } else {
                    titleInput.value = '';
                    noteTextarea.value = '';
                }

                modal.classList.add('show');
            }

            hideModal() {
                const modal = document.getElementById('milestoneModal');
                modal.classList.remove('show');
                this.selectedWeek = null;
            }

            saveMilestone() {
                const title = document.getElementById('milestoneTitle').value.trim();
                const note = document.getElementById('milestoneNote').value.trim();

                if (this.selectedWeek !== null) {
                    if (title || note) {
                        this.personalMilestones[this.selectedWeek] = { title, note };
                    } else {
                        delete this.personalMilestones[this.selectedWeek]; // Remove if empty
                    }
                    this.saveData();
                    this.updateVisualization();
                }
                this.hideModal();
            }

            // --- Core Calculation and Rendering ---
            getWeeksDifference(date1, date2) {
                const diffTime = Math.abs(date2 - date1);
                return Math.floor(diffTime / (1000 * 60 * 60 * 24 * 7));
            }

            getCurrentWeek() {
                return this.getWeeksDifference(this.birthDate, this.today);
            }

            getTotalWeeks() {
                return this.lifeExpectancy * 52;
            }

            getSeasonFromWeek(weekNumber, location) {
                const weekInYear = weekNumber % 52;
                if (location === 'south') {
                    if (weekInYear >= 36 || weekInYear <= 11) return 'summer';
                    if (weekInYear >= 12 && weekInYear <= 23) return 'autumn';
                    if (weekInYear >= 24 && weekInYear <= 35) return 'winter';
                    return 'spring';
                } else {
                    if (weekInYear >= 10 && weekInYear <= 23) return 'spring';
                    if (weekInYear >= 24 && weekInYear <= 37) return 'summer';
                    if (weekInYear >= 38 && weekInYear <= 49) return 'autumn';
                    return 'winter';
                }
            }

            getWorldPopulation(year) {
                const data = this.worldData.populationGrowth;
                const years = Object.keys(data).map(Number).sort();
                if (year <= years[0]) return data[years[0]];
                if (year >= years[years.length - 1]) return data[years[years.length - 1]];
                for (let i = 0; i < years.length - 1; i++) {
                    if (year >= years[i] && year < years[i + 1]) {
                        const ratio = (year - years[i]) / (years[i + 1] - years[i]);
                        return data[years[i]] + (data[years[i + 1]] - data[years[i]]) * ratio;
                    }
                }
                return data[years[0]];
            }

            updateStats() {
                const currentWeek = this.getCurrentWeek();
                const totalWeeks = this.getTotalWeeks();
                const remainingWeeks = totalWeeks - currentWeek;
                const percentLived = Math.round((currentWeek / totalWeeks) * 100);
                const currentYear = new Date().getFullYear();
                const birthYear = this.birthDate.getFullYear();
                const currentPopulation = this.getWorldPopulation(currentYear);
                const birthPopulation = this.getWorldPopulation(birthYear);

                const stats = [
                    {
                        number: totalWeeks.toLocaleString(),
                        label: 'Total Weeks',
                        detail: `You have roughly ${(totalWeeks / 52).toFixed(0)} years to live.`
                    },
                    {
                        number: currentWeek.toLocaleString(),
                        label: 'Weeks Lived',
                        detail: `This represents ${percentLived}% of your life so far.`
                    },
                    {
                        number: remainingWeeks.toLocaleString(),
                        label: 'Weeks Remaining',
                        detail: `You have approximately ${Math.round(remainingWeeks / 52)} years left.`
                    },
                    {
                        number: `${birthPopulation.toFixed(1)}B`,
                        label: 'World Population at Birth',
                        detail: `The world population is now ${currentPopulation.toFixed(1)}B.`
                    }
                ];

                const statsGrid = document.getElementById('statsGrid');
                statsGrid.innerHTML = stats.map(stat => `
                    <div class="stat-card">
                        <span class="stat-number">${stat.number}</span>
                        <span class="stat-label">${stat.label}</span>
                        <div class="stat-detail">${stat.detail}</div>
                    </div>
                `).join('');
            }

            createYearLabels() {
                const yearLabels = document.getElementById('yearLabels');
                yearLabels.innerHTML = '';
                const decades = Math.ceil(this.lifeExpectancy / 10);
                for (let decade = 0; decade < decades; decade++) {
                    const label = document.createElement('div');
                    label.className = 'year-label';
                    label.textContent = (decade * 10) + '–' + Math.min((decade * 10) + 9, this.lifeExpectancy);
                    yearLabels.appendChild(label);
                }
            }

            createGrid() {
                const grid = document.getElementById('grid');
                const currentWeek = this.getCurrentWeek();
                const birthYear = this.birthDate.getFullYear();
                grid.innerHTML = '';

                for (let age = 0; age < this.lifeExpectancy; age++) {
                    const row = document.createElement('div');
                    row.className = 'grid-row';
                    const ageLabel = document.createElement('div');
                    ageLabel.className = 'age-label';
                    ageLabel.textContent = age;
                    row.appendChild(ageLabel);

                    const weeksRow = document.createElement('div');
                    weeksRow.className = 'weeks-row';

                    for (let week = 0; week < 52; week++) {
                        const weekNumber = age * 52 + week;
                        const weekEl = document.createElement('div');
                        weekEl.className = 'week';
                        const currentYear = birthYear + age;

                        if (weekNumber < currentWeek) {
                            weekEl.classList.add('lived');
                        } else if (weekNumber === currentWeek) {
                            weekEl.classList.add('current');
                        } else {
                            weekEl.classList.add('future');
                        }

                        if (this.currentMode === 'seasons') {
                            const season = this.getSeasonFromWeek(weekNumber, this.birthLocation);
                            weekEl.classList.add(`season-${season}`);
                        }

                        if (this.currentMode === 'milestones' && this.worldData.lifeMilestones[age]) {
                            weekEl.classList.add('milestone');
                        }

                        if (this.personalMilestones[weekNumber]) {
                            weekEl.classList.add('personal-milestone');
                        }

                        weekEl.addEventListener('click', (e) => {
                            this.showModal(weekNumber);
                        });

                        weekEl.addEventListener('mouseenter', (e) => {
                            this.showTooltip(e, age, week, weekNumber, currentWeek, currentYear);
                        });

                        weekEl.addEventListener('mouseleave', () => {
                            this.hideTooltip();
                        });

                        weeksRow.appendChild(weekEl);
                    }
                    row.appendChild(weeksRow);
                    grid.appendChild(row);
                }
            }

            showTooltip(e, age, week, weekNumber, currentWeek, year) {
                const tooltip = document.getElementById('tooltip');
                const weekDate = new Date(this.birthDate);
                weekDate.setDate(weekDate.getDate() + (weekNumber * 7));
                let status = weekNumber < currentWeek ? 'Lived' : 
                            weekNumber === currentWeek ? 'Current Week' : 'Future';

                let content = `
                    <strong>Age ${age}, Week ${week + 1} (${year})</strong><br>
                    ${weekDate.toLocaleDateString()}<br>
                    Status: ${status}
                `;

                if (this.personalMilestones[weekNumber]) {
                    const milestone = this.personalMilestones[weekNumber];
                    content += `<br><strong>Personal Milestone:</strong> ${milestone.title}<br><em>${milestone.note}</em>`;
                }

                if (this.currentMode === 'seasons') {
                    const season = this.getSeasonFromWeek(weekNumber, this.birthLocation);
                    content += `<br>Season: ${season.charAt(0).toUpperCase() + season.slice(1)}`;
                }
                if (this.currentMode === 'population') {
                    const population = this.getWorldPopulation(year);
                    content += `<br>World Population: ${population.toFixed(1)}B people`;
                }
                if (this.currentMode === 'milestones') {
                    if (this.worldData.lifeMilestones[age]) {
                        content += `<br><strong>Milestone:</strong> ${this.worldData.lifeMilestones[age]}`;
                    }
                    if (this.worldData.techMilestones[year]) {
                        content += `<br><strong>Tech:</strong> ${this.worldData.techMilestones[year]}`;
                    }
                }

                tooltip.innerHTML = content;
                tooltip.style.left = Math.min(e.pageX + 10, window.innerWidth - 320) + 'px';
                tooltip.style.top = e.pageY - 10 + 'px';
                tooltip.style.opacity = '1';
            }

            hideTooltip() {
                document.getElementById('tooltip').style.opacity = '0';
            }

            updateLegend() {
                const legend = document.getElementById('legend');
                const basicLegend = `
                    <div class="legend-section">
                        <div class="legend-title">Life Status</div>
                        <div class="legend-item">
                            <div class="legend-color lived"></div>
                            <span>Weeks Lived</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color current"></div>
                            <span>Current Week</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color future"></div>
                            <span>Future Weeks</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color personal-milestone"></div>
                            <span>Personal Milestone</span>
                        </div>
                    </div>
                `;

                let modeSpecificLegend = '';
                if (this.currentMode === 'seasons') {
                    modeSpecificLegend = `
                        <div class="legend-section">
                            <div class="legend-title">Seasons</div>
                            <div class="legend-item"><div class="legend-color spring"></div><span>Spring</span></div>
                            <div class="legend-item"><div class="legend-color summer"></div><span>Summer</span></div>
                            <div class="legend-item"><div class="legend-color autumn"></div><span>Autumn</span></div>
                            <div class="legend-item"><div class="legend-color winter"></div><span>Winter</span></div>
                        </div>
                    `;
                }
                if (this.currentMode === 'milestones') {
                    modeSpecificLegend = `
                        <div class="legend-section">
                            <div class="legend-title">Milestones</div>
                            <div class="legend-item"><div class="legend-color milestone"></div><span>General Milestone</span></div>
                        </div>
                    `;
                }
                legend.innerHTML = basicLegend + modeSpecificLegend;
            }

            updateInsights() {
                const insights = document.getElementById('insights');
                const currentAge = Math.floor(this.getCurrentWeek() / 52);
                const birthYear = this.birthDate.getFullYear();
                const currentYear = new Date().getFullYear();
                
                const insightData = [
                    {
                        title: 'Your Lifetime in Context',
                        items: [
                            `You've experienced ${currentAge * 4} seasons so far`,
                            `You've lived through ${currentYear - birthYear} calendar years`,
                            `You've seen ${Math.floor(currentAge / 10)} decades pass`,
                            `You have approximately ${Math.floor((this.lifeExpectancy - currentAge) / 10)} decades remaining`
                        ]
                    },
                    {
                        title: 'World Population During Your Life',
                        items: [
                            `Born when world population was ${this.getWorldPopulation(birthYear).toFixed(1)} billion`,
                            `Current world population: ${this.getWorldPopulation(currentYear).toFixed(1)} billion`,
                            `Population has grown by ${((this.getWorldPopulation(currentYear) - this.getWorldPopulation(birthYear)) * 1000).toFixed(0)} million in your lifetime`,
                            `By age 80, world population may reach ${this.getWorldPopulation(birthYear + 80).toFixed(1)} billion`
                        ]
                    },
                    {
                        title: 'Climate & Environment',
                        items: [
                            `Global temperature has risen ~${((currentYear - birthYear) * 0.018).toFixed(2)}°C since your birth`,
                            `CO₂ levels were ~${this.worldData.climateData.co2Levels[1990] || 354}ppm when you were born`,
                            `Current CO₂ levels: ~${this.worldData.climateData.co2Levels[2020]}ppm`,
                            `You'll likely see significant climate changes in your lifetime`
                        ]
                    },
                    {
                        title: 'Perspective on Time',
                        items: [
                            `Each week represents ${(100/this.getTotalWeeks()).toFixed(3)}% of your entire life`,
                            `A year is ${(52/this.getTotalWeeks()*100).toFixed(1)}% of your total weeks`,
                            `You have roughly ${Math.floor(this.getTotalWeeks()/365.25)} days per week of your life`,
                            `Every 5 years represents ${(260/this.getTotalWeeks()*100).toFixed(1)}% of your total time`
                        ]
                    }
                ];

                insights.innerHTML = insightData.map(section => `
                    <div class="insight-card">
                        <div class="insight-title">${section.title}</div>
                        <ul class="insight-list">
                            ${section.items.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>
                `).join('');
            }

            updateVisualization() {
                this.updateStats();
                this.createYearLabels();
                this.createGrid();
                this.updateLegend();
                this.updateInsights();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new EnhancedLifeInWeeks();
        });
    </script>
</body>
</html>
