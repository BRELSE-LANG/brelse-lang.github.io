<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BrelseAuth ‚Äì Tactile OTP Verification</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
  </style>
</head>
<body class="bg-gray-100 text-black px-6 py-10 max-w-xl mx-auto">

  <h1 class="text-3xl font-bold mb-6 text-center">üîê BrelseAuth</h1>

  <!-- OTP Generator -->
  <section class="mb-8">
    <h2 class="text-xl font-semibold mb-2">1. Generate OTP</h2>
    <button onclick="generateOTP()" class="bg-black text-white px-4 py-2 rounded">Generate</button>
    <div id="generatedOutput" class="mt-4 p-3 bg-white rounded border font-mono"></div>
    <button onclick="playMorse()" class="mt-2 text-sm underline">üîä Play Morse</button>
  </section>

  <!-- OTP Verification -->
  <section>
    <h2 class="text-xl font-semibold mb-2">2. Enter Received Code</h2>
    <input id="userInput" type="text" class="w-full p-3 rounded border font-mono" placeholder="Enter BrelseLang OTP here...">
    <button onclick="verifyCode()" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded">Verify</button>
    <div id="result" class="mt-4 font-semibold"></div>
  </section>

  <script>
    const morseMap = {
      a: ".-", b: "-...", c: "-.-.", d: "-..", e: ".", f: "..-.", g: "--.",
      h: "....", i: "..", j: ".---", k: "-.-", l: ".-..", m: "--", n: "-.",
      o: "---", p: ".--.", q: "--.-", r: ".-.", s: "...", t: "-", u: "..-",
      v: "...-", w: ".--", x: "-..-", y: "-.--", z: "--..", '0': "-----",
      '1': ".----", '2': "..---", '3': "...--", '4': "....-", '5': ".....",
      '6': "-....", '7': "--...", '8': "---..", '9': "----.", ' ': "/"
    };

    let generatedCode = "";

    function generateOTP() {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
      let text = "";
      for (let i = 0; i < 6; i++) {
        text += chars[Math.floor(Math.random() * chars.length)];
      }

      generatedCode = text;
      let output = "";
      for (let ch of text.toLowerCase()) {
        output += `${ch.toUpperCase()}: ${morseMap[ch] || "?"}\n`;
      }

      document.getElementById("generatedOutput").innerText = output;
    }

    function playMorse() {
      const text = generatedCode.toLowerCase();
      if (!text) return alert("Please generate OTP first.");
      const context = new AudioContext();
      let time = context.currentTime;
      const unit = 0.15;
      const freq = 600;

      function beep(duration) {
        const osc = context.createOscillator();
        const gain = context.createGain();
        osc.connect(gain);
        gain.connect(context.destination);
        osc.frequency.value = freq;
        gain.gain.setValueAtTime(1, time);
        gain.gain.exponentialRampToValueAtTime(0.0001, time + duration);
        osc.start(time);
        osc.stop(time + duration);
        time += duration + 0.05;
      }

      for (let ch of text) {
        const code = morseMap[ch] || "";
        for (let symbol of code) {
          if (symbol === ".") beep(unit);
          else if (symbol === "-") beep(unit * 3);
          else if (symbol === "/") time += unit * 4;
        }
        time += unit * 2;
      }
    }

    function verifyCode() {
      const userInput = document.getElementById("userInput").value.trim().toUpperCase();
      const result = document.getElementById("result");

      if (!generatedCode) {
        result.innerText = "‚ùó Generate an OTP first.";
        result.className = "text-red-600 mt-4 font-semibold";
        return;
      }

      if (userInput === generatedCode) {
        result.innerText = "‚úÖ Code Verified!";
        result.className = "text-green-600 mt-4 font-semibold";
      } else {
        result.innerText = "‚ùå Incorrect Code.";
        result.className = "text-red-600 mt-4 font-semibold";
      }
    }
  </script>

</body>
  </html>
